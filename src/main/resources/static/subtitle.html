<!DOCTYPE HTML>
<html lang=zh-cn>
<head>
<meta charset=utf-8>
<title>字幕</title>
<style>
*{margin:0px;padding:0px;}
body{width:100%;height:100%;overflow:hidden;}
.box{display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:center;margin:5px;padding:5px;-webkit-user-select:none;}
.box:hover{background-color:rgba(0,0,0,0.4);-webkit-box-shadow:0 0 5px #646464;cursor:pointer;}
.box:hover .ctrl{display:block;}
.text{position:relative;top:8px;display:-webkit-box;-webkit-box-orient:horizontal;-webkit-box-align:center;font:normal normal bold 60px 微软雅黑,sans-serif;-webkit-filter:brightness(2);}
.text p{
	background:-webkit-linear-gradient(top, rgba(255,255,255,0.5) 0%, rgba(255,255,255,0) 100%), -webkit-linear-gradient(left, #f00 0%, #00f 0%);
	-webkit-background-clip:text;
	-webkit-text-fill-color:transparent;
	/*-webkit-text-stroke:1px #f00;*/
	-webkit-filter:drop-shadow(0px 0px 1px #f00);

}
.ctrl{position:relative;top:25px;height:20px;background:#0aa;display:-webkit-box;-webkit-box-shadow:0 0 5px #646464;display:none;border-radius:4px;}
.ctrl span{padding:0 10px;}
.ctrl span:hover{background:#088;cursor:pointer;}
</style>
</head>
<body style="background: black">

	<span id="screen_mark" style="color: white;"></span><br/>
	<span id="screen_count" style="color: white;"></span>
	<section>
		<div class="box" id="box">
			<div class="text" id="text">
			</div>
			<div id="custom-text" style="color:white">
			</div>
			<div class="ctrl">
				<span id="bigger">放大</span>
				<span id="smaller">缩小</span>
				<span id="lock">锁定</span>
				<span id="close">关闭</span></div>
		</div>
		<p id="screen-id" style="font-size: 200px">{{screenId}}</p>
	</section>


	<script src="./js/jquery-2.1.4.min.js"></script>


	<script language="javascript">
		(function(){

			/*
krc歌词解析目标格式要求
var lines = [{'ws':[{'w':word, 'o':offset, 'd':duration},{'w':word, 'o':offset, 'd':duration},...], 'o':offset, 'd':duration},
			 {'ws':[{'w':word, 'o':offset, 'd':duration},{'w':word, 'o':offset, 'd':duration},...], 'o':offset, 'd':duration},
			 ...]
*/
//一下是模拟krc解析后的歌词数据
var lines = [{"d":2511,"o":0,"ws":[{"d":127,"o":0,"w":"轻"},{"d":175,"o":127,"w":"轻"},{"d":367,"o":302,"w":"敲"},{"d":327,"o":669,"w":"醒"},{"d":223,"o":996,"w":"沉"},{"d":407,"o":1219,"w":"睡"},{"d":183,"o":1626,"w":"的"},{"d":495,"o":1809,"w":"心"},{"d":207,"o":2304,"w":"灵"}]},{"d":2785,"o":3180,"ws":[{"d":303,"o":0,"w":"慢"},{"d":204,"o":303,"w":"慢"},{"d":404,"o":507,"w":"睁"},{"d":254,"o":911,"w":"开"},{"d":405,"o":1165,"w":"你"},{"d":202,"o":1570,"w":"的"},{"d":354,"o":1772,"w":"眼"},{"d":659,"o":2126,"w":"睛"}]},{"d":1793,"o":6648,"ws":[{"d":159,"o":0,"w":"看"},{"d":215,"o":159,"w":"看"},{"d":351,"o":374,"w":"忙"},{"d":367,"o":725,"w":"碌"},{"d":152,"o":1092,"w":"的"},{"d":374,"o":1244,"w":"世"},{"d":175,"o":1618,"w":"界"}]},{"d":4108,"o":8736,"ws":[{"d":327,"o":0,"w":"是"},{"d":359,"o":327,"w":"否"},{"d":367,"o":686,"w":"依"},{"d":519,"o":1053,"w":"然"},{"d":423,"o":1572,"w":"孤"},{"d":287,"o":1995,"w":"独"},{"d":207,"o":2282,"w":"的"},{"d":199,"o":2489,"w":"转"},{"d":191,"o":2688,"w":"个"},{"d":877,"o":2879,"w":"不"},{"d":352,"o":3756,"w":"停"}]},{"d":2737,"o":13870,"ws":[{"d":535,"o":0,"w":"春"},{"d":719,"o":535,"w":"风"},{"d":160,"o":1254,"w":"不"},{"d":214,"o":1414,"w":"解"},{"d":711,"o":1628,"w":"风"},{"d":398,"o":2339,"w":"情"}]},{"d":2000,"o":17230,"ws":[{"d":494,"o":0,"w":"吹"},{"d":254,"o":494,"w":"动"},{"d":344,"o":748,"w":"少"},{"d":191,"o":1092,"w":"年"},{"d":406,"o":1283,"w":"的"},{"d":311,"o":1689,"w":"心"}]},{"d":2344,"o":20588,"ws":[{"d":151,"o":0,"w":"让"},{"d":247,"o":151,"w":"昨"},{"d":472,"o":398,"w":"日"},{"d":254,"o":870,"w":"脸"},{"d":287,"o":1124,"w":"上"},{"d":256,"o":1411,"w":"的"},{"d":431,"o":1667,"w":"泪"},{"d":246,"o":2098,"w":"痕"}]},{"d":2522,"o":23573,"ws":[{"d":191,"o":0,"w":"随"},{"d":662,"o":191,"w":"记"},{"d":367,"o":853,"w":"忆"},{"d":376,"o":1220,"w":"风"},{"d":486,"o":1596,"w":"干"},{"d":440,"o":2082,"w":"了"}]},{"d":2671,"o":28661,"ws":[{"d":167,"o":0,"w":"抬"},{"d":199,"o":167,"w":"头"},{"d":390,"o":366,"w":"寻"},{"d":415,"o":756,"w":"找"},{"d":184,"o":1171,"w":"天"},{"d":439,"o":1355,"w":"空"},{"d":222,"o":1794,"w":"的"},{"d":408,"o":2016,"w":"翅"},{"d":247,"o":2424,"w":"膀"}]},{"d":2497,"o":31948,"ws":[{"d":176,"o":0,"w":"候"},{"d":215,"o":176,"w":"鸟"},{"d":407,"o":391,"w":"出"},{"d":463,"o":798,"w":"现"},{"d":174,"o":1261,"w":"它"},{"d":207,"o":1435,"w":"的"},{"d":487,"o":1642,"w":"影"},{"d":368,"o":2129,"w":"迹"}]},{"d":1858,"o":35340,"ws":[{"d":185,"o":0,"w":"带"},{"d":237,"o":185,"w":"来"},{"d":391,"o":422,"w":"远"},{"d":207,"o":813,"w":"处"},{"d":247,"o":1020,"w":"的"},{"d":399,"o":1267,"w":"饥"},{"d":192,"o":1666,"w":"荒"}]},{"d":3933,"o":37484,"ws":[{"d":175,"o":0,"w":"无"},{"d":415,"o":175,"w":"情"},{"d":207,"o":590,"w":"的"},{"d":392,"o":797,"w":"战"},{"d":470,"o":1189,"w":"火"},{"d":216,"o":1659,"w":"依"},{"d":216,"o":1875,"w":"然"},{"d":182,"o":2091,"w":"存"},{"d":294,"o":2273,"w":"在"},{"d":207,"o":2567,"w":"的"},{"d":872,"o":2774,"w":"消"},{"d":287,"o":3646,"w":"息"}]},{"d":2562,"o":42501,"ws":[{"d":407,"o":0,"w":"玉"},{"d":791,"o":407,"w":"山"},{"d":175,"o":1198,"w":"白"},{"d":279,"o":1373,"w":"雪"},{"d":617,"o":1652,"w":"飘"},{"d":293,"o":2269,"w":"零"}]},{"d":2050,"o":45853,"ws":[{"d":399,"o":0,"w":"燃"},{"d":443,"o":399,"w":"烧"},{"d":203,"o":842,"w":"少"},{"d":489,"o":1045,"w":"年"},{"d":229,"o":1534,"w":"的"},{"d":287,"o":1763,"w":"心"}]},{"d":2536,"o":49181,"ws":[{"d":159,"o":0,"w":"使"},{"d":327,"o":159,"w":"真"},{"d":471,"o":486,"w":"情"},{"d":368,"o":957,"w":"溶"},{"d":302,"o":1325,"w":"化"},{"d":199,"o":1627,"w":"成"},{"d":423,"o":1826,"w":"音"},{"d":287,"o":2249,"w":"符"}]},{"d":2477,"o":52317,"ws":[{"d":377,"o":0,"w":"倾"},{"d":617,"o":377,"w":"诉"},{"d":231,"o":994,"w":"遥"},{"d":295,"o":1225,"w":"远"},{"d":183,"o":1520,"w":"的"},{"d":415,"o":1703,"w":"祝"},{"d":359,"o":2118,"w":"福"}]},{"d":1274,"o":57873,"ws":[{"d":207,"o":0,"w":"唱"},{"d":159,"o":207,"w":"出"},{"d":167,"o":366,"w":"你"},{"d":191,"o":533,"w":"的"},{"d":391,"o":724,"w":"热"},{"d":159,"o":1115,"w":"情"}]},{"d":1342,"o":59441,"ws":[{"d":175,"o":0,"w":"伸"},{"d":450,"o":175,"w":"出"},{"d":143,"o":625,"w":"你"},{"d":408,"o":768,"w":"双"},{"d":166,"o":1176,"w":"手"}]},{"d":2248,"o":61108,"ws":[{"d":167,"o":0,"w":"让"},{"d":199,"o":167,"w":"我"},{"d":200,"o":366,"w":"拥"},{"d":430,"o":566,"w":"抱"},{"d":231,"o":996,"w":"着"},{"d":208,"o":1227,"w":"你"},{"d":286,"o":1435,"w":"的"},{"d":527,"o":1721,"w":"梦"}]},{"d":3789,"o":64461,"ws":[{"d":175,"o":0,"w":"让"},{"d":470,"o":175,"w":"我"},{"d":528,"o":645,"w":"拥"},{"d":207,"o":1173,"w":"有"},{"d":334,"o":1380,"w":"你"},{"d":383,"o":1714,"w":"真"},{"d":471,"o":2097,"w":"心"},{"d":183,"o":2568,"w":"的"},{"d":655,"o":2751,"w":"面"},{"d":383,"o":3406,"w":"孔"}]},{"d":1379,"o":71268,"ws":[{"d":167,"o":0,"w":"让"},{"d":192,"o":167,"w":"我"},{"d":183,"o":359,"w":"们"},{"d":174,"o":542,"w":"的"},{"d":472,"o":716,"w":"笑"},{"d":191,"o":1188,"w":"容"}]},{"d":3753,"o":72964,"ws":[{"d":175,"o":0,"w":"充"},{"d":383,"o":175,"w":"满"},{"d":199,"o":558,"w":"着"},{"d":447,"o":757,"w":"青"},{"d":191,"o":1204,"w":"春"},{"d":240,"o":1395,"w":"的"},{"d":1734,"o":1635,"w":"骄"},{"d":384,"o":3369,"w":"傲"}]},{"d":3941,"o":77861,"ws":[{"d":191,"o":0,"w":"为"},{"d":391,"o":191,"w":"明"},{"d":399,"o":582,"w":"天"},{"d":279,"o":981,"w":"献"},{"d":590,"o":1260,"w":"出"},{"d":391,"o":1850,"w":"虔"},{"d":464,"o":2241,"w":"诚"},{"d":151,"o":2705,"w":"的"},{"d":702,"o":2856,"w":"祈"},{"d":383,"o":3558,"w":"祷"}]},{"d":2583,"o":84476,"ws":[{"d":159,"o":0,"w":"谁"},{"d":167,"o":159,"w":"能"},{"d":399,"o":326,"w":"不"},{"d":440,"o":725,"w":"顾"},{"d":190,"o":1165,"w":"自"},{"d":439,"o":1355,"w":"己"},{"d":215,"o":1794,"w":"的"},{"d":384,"o":2009,"w":"家"},{"d":190,"o":2393,"w":"园"}]},{"d":2496,"o":87804,"ws":[{"d":159,"o":0,"w":"抛"},{"d":191,"o":159,"w":"开"},{"d":432,"o":350,"w":"记"},{"d":454,"o":782,"w":"忆"},{"d":175,"o":1236,"w":"中"},{"d":191,"o":1411,"w":"的"},{"d":472,"o":1602,"w":"童"},{"d":422,"o":2074,"w":"年"}]},{"d":3533,"o":91132,"ws":[{"d":160,"o":0,"w":"谁"},{"d":254,"o":160,"w":"能"},{"d":360,"o":414,"w":"忍"},{"d":462,"o":774,"w":"心"},{"d":455,"o":1236,"w":"看"},{"d":375,"o":1691,"w":"他"},{"d":423,"o":2066,"w":"昨"},{"d":223,"o":2489,"w":"日"},{"d":223,"o":2712,"w":"的"},{"d":432,"o":2935,"w":"忧"},{"d":166,"o":3367,"w":"愁"}]},{"d":2295,"o":94932,"ws":[{"d":184,"o":0,"w":"带"},{"d":223,"o":184,"w":"走"},{"d":191,"o":407,"w":"我"},{"d":407,"o":598,"w":"们"},{"d":199,"o":1005,"w":"的"},{"d":821,"o":1204,"w":"笑"},{"d":270,"o":2025,"w":"容"}]},{"d":2643,"o":98313,"ws":[{"d":392,"o":0,"w":"青"},{"d":831,"o":392,"w":"春"},{"d":183,"o":1223,"w":"不"},{"d":271,"o":1406,"w":"解"},{"d":479,"o":1677,"w":"红"},{"d":487,"o":2156,"w":"尘"}]},{"d":2258,"o":101666,"ws":[{"d":399,"o":0,"w":"胭"},{"d":439,"o":399,"w":"脂"},{"d":191,"o":838,"w":"沾"},{"d":479,"o":1029,"w":"染"},{"d":272,"o":1508,"w":"了"},{"d":478,"o":1780,"w":"灰"}]},{"d":2552,"o":104899,"ws":[{"d":182,"o":0,"w":"让"},{"d":399,"o":182,"w":"久"},{"d":455,"o":581,"w":"违"},{"d":183,"o":1036,"w":"不"},{"d":456,"o":1219,"w":"见"},{"d":207,"o":1675,"w":"的"},{"d":454,"o":1882,"w":"泪"},{"d":216,"o":2336,"w":"水"}]},{"d":2401,"o":108178,"ws":[{"d":295,"o":0,"w":"滋"},{"d":639,"o":295,"w":"润"},{"d":207,"o":934,"w":"了"},{"d":216,"o":1141,"w":"你"},{"d":198,"o":1357,"w":"的"},{"d":440,"o":1555,"w":"面"},{"d":406,"o":1995,"w":"容"}]},{"d":1410,"o":113554,"ws":[{"d":336,"o":0,"w":"唱"},{"d":150,"o":336,"w":"出"},{"d":168,"o":486,"w":"你"},{"d":198,"o":654,"w":"的"},{"d":376,"o":852,"w":"热"},{"d":182,"o":1228,"w":"情"}]},{"d":1424,"o":115218,"ws":[{"d":167,"o":0,"w":"伸"},{"d":476,"o":167,"w":"出"},{"d":175,"o":643,"w":"你"},{"d":431,"o":818,"w":"双"},{"d":175,"o":1249,"w":"手"}]},{"d":2120,"o":116895,"ws":[{"d":191,"o":0,"w":"让"},{"d":183,"o":191,"w":"我"},{"d":215,"o":374,"w":"拥"},{"d":447,"o":589,"w":"抱"},{"d":183,"o":1036,"w":"着"},{"d":183,"o":1219,"w":"你"},{"d":319,"o":1402,"w":"的"},{"d":399,"o":1721,"w":"梦"}]},{"d":3813,"o":120336,"ws":[{"d":430,"o":0,"w":"让"},{"d":192,"o":430,"w":"我"},{"d":534,"o":622,"w":"拥"},{"d":247,"o":1156,"w":"有"},{"d":263,"o":1403,"w":"你"},{"d":415,"o":1666,"w":"真"},{"d":470,"o":2081,"w":"心"},{"d":192,"o":2551,"w":"的"},{"d":655,"o":2743,"w":"面"},{"d":415,"o":3398,"w":"孔"}]},{"d":1370,"o":127111,"ws":[{"d":175,"o":0,"w":"让"},{"d":183,"o":175,"w":"我"},{"d":199,"o":358,"w":"们"},{"d":271,"o":557,"w":"的"},{"d":375,"o":828,"w":"笑"},{"d":167,"o":1203,"w":"容"}]},{"d":4016,"o":128807,"ws":[{"d":175,"o":0,"w":"充"},{"d":383,"o":175,"w":"满"},{"d":207,"o":558,"w":"着"},{"d":375,"o":765,"w":"青"},{"d":199,"o":1140,"w":"春"},{"d":303,"o":1339,"w":"的"},{"d":1687,"o":1642,"w":"骄"},{"d":687,"o":3329,"w":"傲"}]},{"d":4198,"o":133671,"ws":[{"d":247,"o":0,"w":"为"},{"d":351,"o":247,"w":"明"},{"d":407,"o":598,"w":"天"},{"d":183,"o":1005,"w":"献"},{"d":687,"o":1188,"w":"出"},{"d":368,"o":1875,"w":"虔"},{"d":478,"o":2243,"w":"诚"},{"d":175,"o":2721,"w":"的"},{"d":727,"o":2896,"w":"祈"},{"d":575,"o":3623,"w":"祷"}]},{"d":2535,"o":140407,"ws":[{"d":177,"o":0,"w":"轻"},{"d":157,"o":177,"w":"轻"},{"d":303,"o":334,"w":"敲"},{"d":415,"o":637,"w":"醒"},{"d":191,"o":1052,"w":"沉"},{"d":455,"o":1243,"w":"睡"},{"d":207,"o":1698,"w":"的"},{"d":407,"o":1905,"w":"心"},{"d":223,"o":2312,"w":"灵"}]},{"d":2488,"o":143575,"ws":[{"d":179,"o":0,"w":"慢"},{"d":227,"o":179,"w":"慢"},{"d":399,"o":406,"w":"张"},{"d":447,"o":805,"w":"开"},{"d":191,"o":1252,"w":"你"},{"d":199,"o":1443,"w":"的"},{"d":487,"o":1642,"w":"眼"},{"d":359,"o":2129,"w":"睛"}]},{"d":1816,"o":146976,"ws":[{"d":182,"o":0,"w":"看"},{"d":239,"o":182,"w":"那"},{"d":327,"o":421,"w":"忙"},{"d":247,"o":748,"w":"碌"},{"d":247,"o":995,"w":"的"},{"d":407,"o":1242,"w":"世"},{"d":167,"o":1649,"w":"界"}]},{"d":3997,"o":149082,"ws":[{"d":412,"o":0,"w":"是"},{"d":215,"o":412,"w":"否"},{"d":487,"o":627,"w":"依"},{"d":583,"o":1114,"w":"然"},{"d":306,"o":1697,"w":"孤"},{"d":359,"o":2003,"w":"独"},{"d":191,"o":2362,"w":"的"},{"d":207,"o":2553,"w":"转"},{"d":215,"o":2760,"w":"个"},{"d":519,"o":2975,"w":"不"},{"d":503,"o":3494,"w":"停"}]},{"d":2437,"o":154202,"ws":[{"d":575,"o":0,"w":"日"},{"d":583,"o":575,"w":"出"},{"d":176,"o":1158,"w":"唤"},{"d":294,"o":1334,"w":"醒"},{"d":623,"o":1628,"w":"清"},{"d":186,"o":2251,"w":"晨"}]},{"d":2434,"o":157586,"ws":[{"d":343,"o":0,"w":"大"},{"d":495,"o":343,"w":"地"},{"d":199,"o":838,"w":"光"},{"d":391,"o":1037,"w":"彩"},{"d":679,"o":1428,"w":"重"},{"d":327,"o":2107,"w":"生"}]},{"d":2576,"o":160794,"ws":[{"d":172,"o":0,"w":"让"},{"d":402,"o":172,"w":"和"},{"d":431,"o":574,"w":"风"},{"d":287,"o":1005,"w":"拂"},{"d":343,"o":1292,"w":"出"},{"d":191,"o":1635,"w":"的"},{"d":431,"o":1826,"w":"音"},{"d":319,"o":2257,"w":"响"}]},{"d":2601,"o":163938,"ws":[{"d":383,"o":0,"w":"谱"},{"d":679,"o":383,"w":"成"},{"d":167,"o":1062,"w":"生"},{"d":239,"o":1229,"w":"命"},{"d":183,"o":1468,"w":"的"},{"d":471,"o":1651,"w":"乐"},{"d":479,"o":2122,"w":"章"}]},{"d":1306,"o":169402,"ws":[{"d":167,"o":0,"w":"唱"},{"d":183,"o":167,"w":"出"},{"d":183,"o":350,"w":"你"},{"d":279,"o":533,"w":"的"},{"d":351,"o":812,"w":"热"},{"d":143,"o":1163,"w":"情"}]},{"d":1394,"o":171042,"ws":[{"d":167,"o":0,"w":"伸"},{"d":487,"o":167,"w":"出"},{"d":190,"o":654,"w":"你"},{"d":383,"o":844,"w":"双"},{"d":167,"o":1227,"w":"手"}]},{"d":2264,"o":172761,"ws":[{"d":207,"o":0,"w":"让"},{"d":247,"o":207,"w":"我"},{"d":200,"o":454,"w":"拥"},{"d":398,"o":654,"w":"抱"},{"d":191,"o":1052,"w":"着"},{"d":191,"o":1243,"w":"你"},{"d":279,"o":1434,"w":"的"},{"d":551,"o":1713,"w":"梦"}]},{"d":3878,"o":176137,"ws":[{"d":407,"o":0,"w":"让"},{"d":175,"o":407,"w":"我"},{"d":593,"o":582,"w":"拥"},{"d":317,"o":1175,"w":"有"},{"d":223,"o":1492,"w":"你"},{"d":359,"o":1715,"w":"真"},{"d":512,"o":2074,"w":"心"},{"d":198,"o":2586,"w":"的"},{"d":647,"o":2784,"w":"面"},{"d":447,"o":3431,"w":"孔"}]},{"d":1418,"o":182865,"ws":[{"d":175,"o":0,"w":"让"},{"d":223,"o":175,"w":"我"},{"d":207,"o":398,"w":"们"},{"d":295,"o":605,"w":"的"},{"d":375,"o":900,"w":"笑"},{"d":143,"o":1275,"w":"容"}]},{"d":3792,"o":184609,"ws":[{"d":183,"o":0,"w":"充"},{"d":391,"o":183,"w":"满"},{"d":215,"o":574,"w":"着"},{"d":383,"o":789,"w":"青"},{"d":183,"o":1172,"w":"春"},{"d":279,"o":1355,"w":"的"},{"d":1735,"o":1634,"w":"骄"},{"d":423,"o":3369,"w":"傲"}]},{"d":4286,"o":189489,"ws":[{"d":199,"o":0,"w":"让"},{"d":400,"o":199,"w":"我"},{"d":430,"o":599,"w":"们"},{"d":223,"o":1029,"w":"期"},{"d":504,"o":1252,"w":"待"},{"d":502,"o":1756,"w":"明"},{"d":463,"o":2258,"w":"天"},{"d":207,"o":2721,"w":"会"},{"d":687,"o":2928,"w":"更"},{"d":671,"o":3615,"w":"好"}]},{"d":1266,"o":196537,"ws":[{"d":175,"o":0,"w":"唱"},{"d":199,"o":175,"w":"出"},{"d":167,"o":374,"w":"你"},{"d":216,"o":541,"w":"的"},{"d":342,"o":757,"w":"热"},{"d":167,"o":1099,"w":"情"}]},{"d":1373,"o":198145,"ws":[{"d":183,"o":0,"w":"伸"},{"d":425,"o":183,"w":"出"},{"d":183,"o":608,"w":"你"},{"d":375,"o":791,"w":"双"},{"d":207,"o":1166,"w":"手"}]},{"d":2280,"o":199779,"ws":[{"d":183,"o":0,"w":"让"},{"d":191,"o":183,"w":"我"},{"d":215,"o":374,"w":"拥"},{"d":407,"o":589,"w":"抱"},{"d":191,"o":996,"w":"着"},{"d":207,"o":1187,"w":"你"},{"d":327,"o":1394,"w":"的"},{"d":559,"o":1721,"w":"梦"}]},{"d":4126,"o":203179,"ws":[{"d":351,"o":0,"w":"让"},{"d":207,"o":351,"w":"我"},{"d":431,"o":558,"w":"拥"},{"d":407,"o":989,"w":"有"},{"d":215,"o":1396,"w":"你"},{"d":423,"o":1611,"w":"真"},{"d":479,"o":2034,"w":"心"},{"d":183,"o":2513,"w":"的"},{"d":671,"o":2696,"w":"面"},{"d":759,"o":3367,"w":"孔"}]},{"d":1385,"o":209940,"ws":[{"d":206,"o":0,"w":"让"},{"d":168,"o":206,"w":"我"},{"d":182,"o":374,"w":"们"},{"d":279,"o":556,"w":"的"},{"d":335,"o":835,"w":"笑"},{"d":215,"o":1170,"w":"容"}]},{"d":4040,"o":211603,"ws":[{"d":207,"o":0,"w":"充"},{"d":375,"o":207,"w":"满"},{"d":207,"o":582,"w":"着"},{"d":423,"o":789,"w":"青"},{"d":200,"o":1212,"w":"春"},{"d":278,"o":1412,"w":"的"},{"d":1807,"o":1690,"w":"骄"},{"d":543,"o":3497,"w":"傲"}]},{"d":4062,"o":216523,"ws":[{"d":191,"o":0,"w":"让"},{"d":439,"o":191,"w":"我"},{"d":383,"o":630,"w":"们"},{"d":264,"o":1013,"w":"期"},{"d":646,"o":1277,"w":"待"},{"d":311,"o":1923,"w":"明"},{"d":479,"o":2234,"w":"天"},{"d":167,"o":2713,"w":"会"},{"d":727,"o":2880,"w":"更"},{"d":455,"o":3607,"w":"好"}]},{"d":1314,"o":223563,"ws":[{"d":167,"o":0,"w":"唱"},{"d":175,"o":167,"w":"出"},{"d":183,"o":342,"w":"你"},{"d":231,"o":525,"w":"的"},{"d":391,"o":756,"w":"热"},{"d":167,"o":1147,"w":"情"}]},{"d":1411,"o":225147,"ws":[{"d":183,"o":0,"w":"伸"},{"d":487,"o":183,"w":"出"},{"d":183,"o":670,"w":"你"},{"d":399,"o":853,"w":"双"},{"d":159,"o":1252,"w":"手"}]},{"d":2200,"o":226867,"ws":[{"d":177,"o":0,"w":"让"},{"d":205,"o":177,"w":"我"},{"d":200,"o":382,"w":"拥"},{"d":438,"o":582,"w":"抱"},{"d":184,"o":1020,"w":"着"},{"d":200,"o":1204,"w":"你"},{"d":301,"o":1404,"w":"的"},{"d":495,"o":1705,"w":"梦"}]},{"d":3918,"o":230291,"ws":[{"d":343,"o":0,"w":"让"},{"d":191,"o":343,"w":"我"},{"d":479,"o":534,"w":"拥"},{"d":343,"o":1013,"w":"有"},{"d":255,"o":1356,"w":"你"},{"d":399,"o":1611,"w":"真"},{"d":479,"o":2010,"w":"心"},{"d":191,"o":2489,"w":"的"},{"d":711,"o":2680,"w":"面"},{"d":527,"o":3391,"w":"孔"}]},{"d":1402,"o":237003,"ws":[{"d":183,"o":0,"w":"让"},{"d":223,"o":183,"w":"我"},{"d":191,"o":406,"w":"们"},{"d":271,"o":597,"w":"的"},{"d":375,"o":868,"w":"笑"},{"d":159,"o":1243,"w":"容"}]},{"d":4165,"o":238698,"ws":[{"d":226,"o":0,"w":"充"},{"d":199,"o":226,"w":"满"},{"d":423,"o":425,"w":"着"},{"d":392,"o":848,"w":"青"},{"d":182,"o":1240,"w":"春"},{"d":271,"o":1422,"w":"的"},{"d":1687,"o":1693,"w":"骄"},{"d":785,"o":3380,"w":"傲"}]},{"d":4231,"o":243623,"ws":[{"d":255,"o":0,"w":"让"},{"d":160,"o":255,"w":"我"},{"d":528,"o":415,"w":"们"},{"d":176,"o":943,"w":"期"},{"d":720,"o":1119,"w":"待"},{"d":392,"o":1839,"w":"明"},{"d":504,"o":2231,"w":"天"},{"d":208,"o":2735,"w":"会"},{"d":728,"o":2943,"w":"更"},{"d":560,"o":3671,"w":"好"}]}];
// var offset = 0;
// var duration = 0;
// for (var i = 0; i < 1000; i++) {
// 	duration = 7400; 
// 	lines.push({'ws':[{'w':"这", 'o':0, 'd':300},{'w':"是", 'o':300, 'd':400},{'w':"歌", 'o':700, 'd':200},{'w':"词", 'o':900, 'd':500},{'w':"测", 'o':1900, 'd':100},{'w':"试", 'o':2000, 'd':400},{'w':"，", 'o':2400, 'd':800},{'w':"请", 'o':3200, 'd':1200},{'w':"关", 'o':4400, 'd':1000},{'w':"注", 'o':5400, 'd':200},{'w':"效", 'o':5600, 'd':1600},{'w':"果", 'o':7200, 'd':200}], 'o':offset, 'd':duration});
// 	offset += 7400; 
// 	duration = 7300; 	
// 	lines.push({'ws':[{'w':"经", 'o':0, 'd':200},{'w':"测", 'o':200, 'd':500},{'w':"试", 'o':700, 'd':200},{'w':"，", 'o':900, 'd':1000},{'w':"网", 'o':1900, 'd':200},{'w':"页", 'o':2100, 'd':500},{'w':"的", 'o':2600, 'd':200},{'w':"效", 'o':2800, 'd':300},{'w':"果", 'o':3900, 'd':300},{'w':"也", 'o':4200, 'd':100},{'w':"还", 'o':4300, 'd':300},{'w':"不", 'o':5700, 'd':600},{'w':"错", 'o':6300, 'd':1000}], 'o':offset, 'd':duration});
// 	offset += 7300; 
// }




	var screenId;
	var screenCount;
	var fontSize = '200px';
	 if (window.location.search.split('?')[1]) {
	 	var search = window.location.search.split('?')[1].split('&');

	 	for (var i = 0 ; i < search.length ; i++ ) {
	 		var key = search[i].split('=')[0];
	 		if ("screenId" === key) {
	 			screenId = parseInt(search[i].split('=')[1]);
				$("#screen_mark").text("我是第" + screenId + "台计算机");
	 		}
	 		if ("screenCount" === key) {
	 			screenCount = parseInt(search[i].split('=')[1]);
				$("#screen_count").text("共" + screenCount + "台计算机");
	 		}
	 	}
	 }

	/*
    将解析后的一行歌词添加到dom中
    */
var _etext = document.getElementById("text");
var wstoes = function(words) {
	var ps = "";
	for (var i = 0; i < words.length; i++) {
		ps += "<p>" + words[i]['w'] + "</p>";
	}
	_etext.innerHTML = ps;

	var _eps = _etext.getElementsByTagName("p");
	for (var i = 0; i < words.length; i++) {
		_eps[i].offset = words[i]['o'];
		_eps[i].duration = words[i]['d'];
        $('p').css('fontSize', fontSize);
	}
	return _eps;
}


var step = 30; // 默认刷新时长30ms，刷新时长配置对桌面歌词性能影响较大
var timer; // 启动单个字推进的定时器
var wordsTimers = [];
/*
处理单个显示元素
_eps: dom节点列表，表示歌词中单个显示元素
_index: 当前变化元素的索引
_ps: process step，每次timeout推进的步长
_process: 当前变化元素的进度（0-100）
pos: 对该元素进行处理时间点，在哪个timeout点处理
count: timeout的次数
*/
var _processw = function(_eps, _index, _ps, _process, pos, count){
	_ep = _eps[_index];
	if (count >= pos) {
		_process += _ps;
		_ep.style.backgroundImage = "-webkit-linear-gradient(top, rgba(255,255,255,0.5) 0%, rgba(255,255,255,0) 100%), -webkit-linear-gradient(left, #f00 " + _process + "%, #00f 0%)";
		
		if (_process >= 99) {
			if ((_index+1) >= _eps.length) { //该句结束退出
				return;
			}
			_index++;
			var ts = Math.round(_eps[_index].duration/step)==0?1:Math.round(_eps[_index].duration/step);
			_ps = 100/ts;
			_process = 0;
			pos = Math.round(_eps[_index].offset/step);
		}
	}
	count++;
	timer = setTimeout(_processw.bind(this, _eps, _index, _ps, _process, pos, count), step);
    wordsTimers.push(timer);
}

/*
处理单行
*/
var _processL = function(words) {
	var _eps = wstoes(words);
	clearTimeout(timer); //清除上一行因为页面渲染延迟没有处理完的定时器
	_processw(_eps, 0, 100/Math.round(_eps[0].duration/step), 0, Math.round(_eps[0].offset/step), 0);
}

/*
处理全部krc歌词
*/
var timers = [];
var _processK = function() {
	for (var i = 0; i < lines.length; i++) {
		var timer = setTimeout(_processL.bind(this, lines[i]['ws']), lines[i]['o']);
		timers.push(timer);
	}
	var leftOffset = document.body.offsetWidth * screenId;
	$('body').css('position', 'absolute').css('left', -leftOffset);
	$('body').css('width', screenCount * 100 + '%')
}


	var server_location = window.location.origin;
 	var web_socket_server_location = server_location.replace("https:", "ws:").replace("http:", "ws:");

 	var ws = new WebSocket(web_socket_server_location + "/chat-room/" + screenId);// 与服务器建立长连接

	ws.onopen = function(evt) {
		console.log('Connection open ...');
		ws.send('Hello WebSockets!');
	}

	var customText = document.getElementById('custom-text');
	ws.onmessage = function(evt) {
		console.log('Received Message: ' + evt.data)
		// ws.close();
		var data = JSON.parse(evt.data);
		if ("start" === data.order) {
            $('#text').css('display', 'none');
		    for(var i=0,len = timers.length; i < len; i++) {
		        clearTimeout(timers[i]);
			}
			for (var j = 0,jLen = wordsTimers.length; j<jLen;j++) {
                clearTimeout(wordsTimers[j]);
            }
			//启动处理
			_processK();

            $('#custom-text').css('display', 'none');
            $('#text').css('display', '-webkit-inline-box');
			$("#screen_mark").hide();
		} else if ("reset" === data.order) {
			window.location.reload();
		} else if ("customMessage" === data.order) {
		    var msg = data.message;
            customText.innerHTML = '<p>' + msg + '</p>';
		    $('p').css('font-size', fontSize);
		    $('#custom-text').css('display', 'block');
		    $('#text').css('display', 'none');
		} else if ("resizeFontSize" === data.order) {
		    // 设置字体大小
			fontSize = data.fontSize;

		}

	}

	ws.onclose = function(evt) {
		console.log('Connection closed!');
	}


//启动处理
//_processK();


///////////////////////////////////////////////////////
// 下面是一些用户操作响应
document.getElementById("text").addEventListener("mousedown", winmove, false);
document.getElementById("bigger").addEventListener("click", bigger, false);
document.getElementById("smaller").addEventListener("click", smaller, false);
document.getElementById("lock").addEventListener("click", lock, false);
document.getElementById("close").addEventListener("click", close, false);
function winmove(_Event){
	channel.Call('winctrl.dragWindow');
}
/*
字体变大
*/
var fontsize = 60;
function bigger(_Event){
	if (fontsize < 80){
		fontsize += 2;
		var font = "normal normal bold " + fontsize + "px 微软雅黑,sans-serif"
		_etext.style.font = font;
	}
}
/*
字体变小
*/
function smaller(_Event){
	if (fontsize > 16){
			fontsize -= 2;
			var font = "normal normal bold " + fontsize + "px 微软雅黑,sans-serif"
			_etext.style.font = font;
	} 
}
/*
窗口锁定，在PC混合应用容器中有效
*/
function lock(_Event){
	if(typeof(channel) == "undefined") {
		alert("窗口锁定功能只在pc混合应用容器中有效");
	} else {
		channel.Call('winctrl.lockwindow');
	}
}
/*
窗口关闭，在PC混合应用容器中有效
*/
function close(_Event){
	if(typeof(channel) == "undefined") {
		alert("窗口关闭功能只在pc混合应用容器中有效");
	} else {
		channel.Call('winctrl.sendMessage', [{"src":"lrc", "action":"close"}]);
	}
	
}

})();
	</script>
</body>
</html>

